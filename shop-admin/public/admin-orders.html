<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>Neon Admin ‚Äî –ó–∞–∫–∞–∑—ã</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./admin.css" />
  </head>

  <body>
    <div class="admin-page">
      <!-- HEADER -->
      <header class="admin-header">
        <div class="admin-brand">
          <div class="admin-logo-circle">ON</div>
          <div class="admin-brand-text">
            <div class="admin-brand-title">Oleg & Neuro</div>
            <div class="admin-brand-sub">Neon Admin 2025</div>
          </div>
        </div>

        <div class="admin-header-right">
          <div class="admin-status-pill" id="admin-status">üü° API...</div>
          <button
            onclick="window.location.href='/admin.html'"
            class="admin-logout-btn"
          >
            ‚Üê –ù–∞–∑–∞–¥
          </button>
        </div>
      </header>

      <!-- MAIN -->
      <div class="admin-layout">
        <!-- SIDEBAR -->
        <aside class="admin-sidebar">
          <h2>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h2>
          <button class="side-link" onclick="location.href='/admin.html'">
            üì¶ –¢–æ–≤–∞—Ä—ã
          </button>
          <button class="side-link" onclick="location.href='/admin-add.html'">
            ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
          </button>
          <button class="side-link active">üìë –ó–∞–∫–∞–∑—ã</button>
          <button class="side-link" onclick="location.href='/admin-stats.html'">
            üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
          </button>
        </aside>

        <!-- CONTENT -->
        <main class="admin-content">
          <section class="admin-top-panel">
            <h1>üìë –ó–∞–∫–∞–∑—ã</h1>
          </section>

          <!-- TABLE -->
          <section class="admin-table-section">
            <div class="table-header">
              <h2>–°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤</h2>
              <span class="table-hint">–î–∞–Ω–Ω—ã–µ –∏–∑ API</span>
            </div>

            <div class="table-wrapper">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                    <th>–°—É–º–º–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–¢–æ–≤–∞—Ä—ã</th>
                    <th class="actions-col">–î–µ–π—Å—Ç–≤–∏—è</th>
                  </tr>
                </thead>
                <tbody id="orders-body">
                  <tr>
                    <td colspan="7" class="loading-row">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </main>
      </div>
    </div>

    <script>
      async function loadOrders() {
        const tbody = document.getElementById("orders-body");
        tbody.innerHTML =
          "<tr><td colspan='7' class='loading-row'>–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>";

        const res = await fetch("http://localhost:4000/api/orders");
        const orders = await res.json();

        tbody.innerHTML = "";

        orders.forEach((o) => {
          const row = document.createElement("tr");

          const itemsText = o.items
            .map((i) => `${i.title} (${i.quantity} —à—Ç.)`)
            .join("<br>");

          row.innerHTML = `
            <td>${o.id}</td>
            <td>${o.customer_name}</td>
            <td>${o.customer_phone}</td>
            <td>${o.total_price} $</td>

            <td>
              <select data-id="${o.id}" class="status-select">
                <option value="new" ${
                  o.status === "new" ? "selected" : ""
                }>–ù–æ–≤—ã–π</option>
                <option value="processing" ${
                  o.status === "processing" ? "selected" : ""
                }>–í —Ä–∞–±–æ—Ç–µ</option>
                <option value="shipped" ${
                  o.status === "shipped" ? "selected" : ""
                }>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω</option>
                <option value="completed" ${
                  o.status === "completed" ? "selected" : ""
                }>–ó–∞–≤–µ—Ä—à—ë–Ω</option>
              </select>
            </td>

            <td>${itemsText}</td>

            <td>
              <button class="ap-delete" onclick="deleteOrder(${
                o.id
              })">üóë –£–¥–∞–ª–∏—Ç—å</button>
            </td>
          `;

          tbody.appendChild(row);
        });

        // –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞
        document.querySelectorAll(".status-select").forEach((sel) => {
          sel.addEventListener("change", async (e) => {
            const id = e.target.getAttribute("data-id");
            const status = e.target.value;

            await fetch(`http://localhost:4000/api/orders/${id}/status`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ status }),
            });

            loadOrders();
          });
        });
      }

      async function deleteOrder(id) {
        if (!confirm("–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑?")) return;

        await fetch(`http://localhost:4000/api/orders/${id}`, {
          method: "DELETE",
        });

        loadOrders();
      }

      loadOrders();
    </script>
  </body>
</html>
